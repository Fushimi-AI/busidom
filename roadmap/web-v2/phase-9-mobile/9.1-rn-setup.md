# Feature 9.1: React Native Setup (Mobile)

## Metadata
| Field | Value |
|-------|-------|
| **Feature ID** | WEB-9.1 |
| **Phase** | 9 - Mobile Application (Mobile) |
| **Priority** | Critical |
| **Estimated Effort** | 4-5 hours |
| **Dependencies** | WEB-7.4 (API Layer), WEB-7.2 (Auth System) |
| **Approval** | [ ] |
| **Status** | Not Started |

---

## Overview

Initialize React Native mobile application with Expo, TypeScript, navigation, state management, and shared components for iOS and Android.

## User Story

As a **mobile developer**, I want **a React Native foundation** so that **I can build native iOS and Android apps efficiently**.

---

## Requirements

### Functional
1. React Native with Expo SDK
2. TypeScript configuration
3. React Navigation setup
4. State management (Zustand)
5. API client setup
6. Authentication flow
7. Theme system

### Non-Functional
- Fast app startup (< 3s)
- Smooth 60fps animations
- Native look and feel
- Small bundle size (< 50MB)

---

## Technical Specification

### Project Initialization

```bash
# Create Expo app
npx create-expo-app business-os-mobile --template expo-template-blank-typescript

cd business-os-mobile

# Install dependencies
npx expo install react-native-screens react-native-safe-area-context
npm install @react-navigation/native @react-navigation/stack @react-navigation/bottom-tabs
npm install zustand axios react-native-async-storage
npm install expo-auth-session expo-secure-store
npm install @expo/vector-icons lucide-react-native
```

### Project Structure

```
business-os-mobile/
├── src/
│   ├── screens/           # Screen components
│   │   ├── auth/
│   │   ├── chat/
│   │   ├── workflows/
│   │   └── settings/
│   ├── components/        # Reusable components
│   │   ├── ui/
│   │   ├── chat/
│   │   └── workflows/
│   ├── navigation/        # Navigation setup
│   │   ├── AppNavigator.tsx
│   │   ├── AuthNavigator.tsx
│   │   └── MainNavigator.tsx
│   ├── services/          # API services
│   │   ├── api.ts
│   │   └── auth.ts
│   ├── store/             # Zustand stores
│   │   ├── authStore.ts
│   │   ├── businessStore.ts
│   │   └── chatStore.ts
│   ├── hooks/             # Custom hooks
│   ├── utils/             # Utilities
│   ├── types/             # TypeScript types
│   └── theme/             # Theme configuration
├── App.tsx
├── app.json
└── package.json
```

### App Entry Point

```tsx
// App.tsx
import 'react-native-gesture-handler';
import React from 'react';
import { StatusBar } from 'expo-status-bar';
import { SafeAreaProvider } from 'react-native-safe-area-context';
import { AppNavigator } from './src/navigation/AppNavigator';
import { ThemeProvider } from './src/theme/ThemeProvider';

export default function App() {
  return (
    <SafeAreaProvider>
      <ThemeProvider>
        <AppNavigator />
        <StatusBar style="auto" />
      </ThemeProvider>
    </SafeAreaProvider>
  );
}
```

### Navigation Setup

```tsx
// src/navigation/AppNavigator.tsx
import React from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { createStackNavigator } from '@react-navigation/stack';
import { useAuthStore } from '../store/authStore';
import { AuthNavigator } from './AuthNavigator';
import { MainNavigator } from './MainNavigator';

const Stack = createStackNavigator();

export function AppNavigator() {
  const { isAuthenticated } = useAuthStore();

  return (
    <NavigationContainer>
      <Stack.Navigator screenOptions={{ headerShown: false }}>
        {isAuthenticated ? (
          <Stack.Screen name="Main" component={MainNavigator} />
        ) : (
          <Stack.Screen name="Auth" component={AuthNavigator} />
        )}
      </Stack.Navigator>
    </NavigationContainer>
  );
}

// src/navigation/MainNavigator.tsx
import React from 'react';
import { createBottomTabNavigator } from '@react-navigation/bottom-tabs';
import { MessageSquare, Briefcase, Workflow, Settings } from 'lucide-react-native';
import { ChatScreen } from '../screens/chat/ChatScreen';
import { BusinessesScreen } from '../screens/businesses/BusinessesScreen';
import { WorkflowsScreen } from '../screens/workflows/WorkflowsScreen';
import { SettingsScreen } from '../screens/settings/SettingsScreen';

const Tab = createBottomTabNavigator();

export function MainNavigator() {
  return (
    <Tab.Navigator
      screenOptions={{
        tabBarActiveTintColor: '#3b82f6',
        tabBarInactiveTintColor: '#9ca3af'
      }}
    >
      <Tab.Screen
        name="Chat"
        component={ChatScreen}
        options={{
          tabBarIcon: ({ color, size }) => (
            <MessageSquare color={color} size={size} />
          )
        }}
      />

      <Tab.Screen
        name="Businesses"
        component={BusinessesScreen}
        options={{
          tabBarIcon: ({ color, size }) => (
            <Briefcase color={color} size={size} />
          )
        }}
      />

      <Tab.Screen
        name="Workflows"
        component={WorkflowsScreen}
        options={{
          tabBarIcon: ({ color, size }) => (
            <Workflow color={color} size={size} />
          )
        }}
      />

      <Tab.Screen
        name="Settings"
        component={SettingsScreen}
        options={{
          tabBarIcon: ({ color, size }) => (
            <Settings color={color} size={size} />
          )
        }}
      />
    </Tab.Navigator>
  );
}
```

### Auth Store

```typescript
// src/store/authStore.ts
import { create } from 'zustand';
import * as SecureStore from 'expo-secure-store';

interface AuthState {
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;
  login: (email: string, password: string) => Promise<void>;
  logout: () => Promise<void>;
  loadToken: () => Promise<void>;
}

export const useAuthStore = create<AuthState>((set) => ({
  user: null,
  token: null,
  isAuthenticated: false,

  login: async (email, password) => {
    const res = await fetch('https://api.business-os.dev/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });

    const data = await res.json();

    await SecureStore.setItemAsync('auth_token', data.token);

    set({
      user: data.user,
      token: data.token,
      isAuthenticated: true
    });
  },

  logout: async () => {
    await SecureStore.deleteItemAsync('auth_token');

    set({
      user: null,
      token: null,
      isAuthenticated: false
    });
  },

  loadToken: async () => {
    const token = await SecureStore.getItemAsync('auth_token');

    if (token) {
      // Verify token with API
      const res = await fetch('https://api.business-os.dev/auth/me', {
        headers: { Authorization: `Bearer ${token}` }
      });

      if (res.ok) {
        const user = await res.json();
        set({ user, token, isAuthenticated: true });
      } else {
        await SecureStore.deleteItemAsync('auth_token');
      }
    }
  }
}));
```

### API Client

```typescript
// src/services/api.ts
import axios from 'axios';
import { useAuthStore } from '../store/authStore';

const api = axios.create({
  baseURL: 'https://api.business-os.dev',
  timeout: 10000
});

// Request interceptor (add auth token)
api.interceptors.request.use(
  (config) => {
    const token = useAuthStore.getState().token;

    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }

    return config;
  },
  (error) => Promise.reject(error)
);

// Response interceptor (handle 401)
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401) {
      await useAuthStore.getState().logout();
    }

    return Promise.reject(error);
  }
);

export default api;
```

### Theme System

```typescript
// src/theme/theme.ts
export const lightTheme = {
  colors: {
    primary: '#3b82f6',
    background: '#ffffff',
    card: '#f9fafb',
    text: '#111827',
    textSecondary: '#6b7280',
    border: '#e5e7eb',
    error: '#ef4444',
    success: '#10b981'
  },
  spacing: {
    xs: 4,
    sm: 8,
    md: 16,
    lg: 24,
    xl: 32
  },
  borderRadius: {
    sm: 4,
    md: 8,
    lg: 12
  }
};

export const darkTheme = {
  ...lightTheme,
  colors: {
    ...lightTheme.colors,
    background: '#111827',
    card: '#1f2937',
    text: '#f9fafb',
    textSecondary: '#9ca3af',
    border: '#374151'
  }
};

// src/theme/ThemeProvider.tsx
import React, { createContext, useContext, useState } from 'react';
import { lightTheme, darkTheme } from './theme';

const ThemeContext = createContext<any>(null);

export function ThemeProvider({ children }: { children: React.ReactNode }) {
  const [isDark, setIsDark] = useState(false);

  const theme = isDark ? darkTheme : lightTheme;

  return (
    <ThemeContext.Provider value={{ theme, isDark, setIsDark }}>
      {children}
    </ThemeContext.Provider>
  );
}

export const useTheme = () => useContext(ThemeContext);
```

---

## Tasks

| Task | Estimate |
|------|----------|
| Initialize Expo project | 20 min |
| Set up navigation | 60 min |
| Configure TypeScript | 20 min |
| Set up state management | 45 min |
| Create API client | 45 min |
| Set up authentication flow | 60 min |
| Configure theme system | 30 min |

---

## Acceptance Criteria
- [ ] Expo app runs on iOS/Android
- [ ] Navigation works smoothly
- [ ] TypeScript configured
- [ ] State management working
- [ ] API client configured
- [ ] Auth flow functional
- [ ] Theme system implemented

---

## Dependencies

```json
{
  "dependencies": {
    "expo": "~50.0.0",
    "react": "18.2.0",
    "react-native": "0.73.0",
    "@react-navigation/native": "^6.1.9",
    "@react-navigation/stack": "^6.3.20",
    "@react-navigation/bottom-tabs": "^6.5.11",
    "react-native-screens": "^3.29.0",
    "react-native-safe-area-context": "^4.8.0",
    "zustand": "^4.4.7",
    "axios": "^1.6.2",
    "expo-secure-store": "~12.8.0",
    "lucide-react-native": "^0.300.0"
  }
}
```

---

## app.json Configuration

```json
{
  "expo": {
    "name": "Business-OS",
    "slug": "business-os",
    "version": "1.0.0",
    "orientation": "portrait",
    "icon": "./assets/icon.png",
    "splash": {
      "image": "./assets/splash.png",
      "resizeMode": "contain",
      "backgroundColor": "#3b82f6"
    },
    "ios": {
      "bundleIdentifier": "com.businessos.app",
      "supportsTablet": true
    },
    "android": {
      "package": "com.businessos.app",
      "adaptiveIcon": {
        "foregroundImage": "./assets/adaptive-icon.png",
        "backgroundColor": "#3b82f6"
      }
    },
    "plugins": [
      "expo-secure-store"
    ]
  }
}
```
