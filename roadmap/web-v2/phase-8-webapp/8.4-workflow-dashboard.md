# Feature 8.4: Workflow Dashboard (Web)

## Metadata
| Field | Value |
|-------|-------|
| **Feature ID** | WEB-8.4 |
| **Phase** | 8 - Web Application (Web) |
| **Priority** | High |
| **Estimated Effort** | 4-5 hours |
| **Dependencies** | WEB-8.1 (Next.js Setup), WEB-4.5.1 (Workflow Engine) |
| **Approval** | [ ] |
| **Status** | Not Started |

---

## Overview

Visual workflow dashboard showing available workflows, in-progress executions, completion history, and interactive workflow builder interface.

## User Story

As a **web user**, I want **a visual workflow dashboard** so that **I can easily see and manage my automated business processes**.

---

## Requirements

### Functional
1. List available workflows (by stage)
2. Display in-progress workflows
3. Show execution history
4. Start workflow (interactive)
5. View workflow details
6. Pause/resume workflows
7. Progress visualization

### Non-Functional
- Smooth animations
- Real-time progress updates
- Mobile-responsive
- Fast loading (<1s)

---

## Technical Specification

### Workflow Dashboard Page

```tsx
// src/app/(dashboard)/workflows/page.tsx
'use client';

import { useState } from 'react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { WorkflowLibrary } from '@/components/workflows/workflow-library';
import { ActiveWorkflows } from '@/components/workflows/active-workflows';
import { WorkflowHistory } from '@/components/workflows/workflow-history';

export default function WorkflowsPage() {
  return (
    <div>
      <div className="mb-6">
        <h1 className="text-3xl font-bold">Workflows</h1>
        <p className="text-muted-foreground">
          Automate your business processes with pre-built workflows
        </p>
      </div>

      <Tabs defaultValue="library" className="space-y-6">
        <TabsList>
          <TabsTrigger value="library">Library</TabsTrigger>
          <TabsTrigger value="active">Active</TabsTrigger>
          <TabsTrigger value="history">History</TabsTrigger>
        </TabsList>

        <TabsContent value="library">
          <WorkflowLibrary />
        </TabsContent>

        <TabsContent value="active">
          <ActiveWorkflows />
        </TabsContent>

        <TabsContent value="history">
          <WorkflowHistory />
        </TabsContent>
      </Tabs>
    </div>
  );
}
```

### Workflow Library Component

```tsx
// src/components/workflows/workflow-library.tsx
'use client';

import { useEffect, useState } from 'react';
import { useBusiness } from '@/hooks/useBusiness';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Play, Clock, CheckCircle } from 'lucide-react';
import { WorkflowDefinition } from '@/types';

export function WorkflowLibrary() {
  const { currentBusiness } = useBusiness();
  const [workflows, setWorkflows] = useState<WorkflowDefinition[]>([]);
  const [groupedWorkflows, setGroupedWorkflows] = useState<Record<string, WorkflowDefinition[]>>({});

  useEffect(() => {
    fetchWorkflows();
  }, []);

  const fetchWorkflows = async () => {
    const res = await fetch('/api/workflows');
    const data = await res.json();
    setWorkflows(data);

    // Group by stage
    const grouped = data.reduce((acc: any, wf: WorkflowDefinition) => {
      const stage = wf.metadata?.stage || 'all';
      if (!acc[stage]) acc[stage] = [];
      acc[stage].push(wf);
      return acc;
    }, {});

    setGroupedWorkflows(grouped);
  };

  const handleStartWorkflow = (workflowId: string) => {
    window.location.href = `/workflows/${workflowId}/start`;
  };

  const stages = ['idea', 'validation', 'mvp', 'growth', 'scale'];

  return (
    <div className="space-y-8">
      {stages.map((stage) => {
        const stageWorkflows = groupedWorkflows[stage] || [];

        if (stageWorkflows.length === 0) return null;

        const isCurrentStage = currentBusiness?.stage === stage;

        return (
          <div key={stage}>
            <div className="flex items-center gap-2 mb-4">
              <h2 className="text-xl font-semibold capitalize">{stage} Stage</h2>
              {isCurrentStage && (
                <Badge variant="default">Current Stage</Badge>
              )}
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {stageWorkflows.map((workflow) => (
                <Card key={workflow.id} className="hover:shadow-lg transition-shadow">
                  <CardHeader>
                    <CardTitle className="flex items-start justify-between">
                      <span>{workflow.name}</span>
                      <Badge variant="outline">
                        {workflow.steps.length} steps
                      </Badge>
                    </CardTitle>
                    <CardDescription>{workflow.description}</CardDescription>
                  </CardHeader>

                  <CardContent>
                    <div className="flex items-center gap-2 text-sm text-muted-foreground mb-4">
                      <Clock className="w-4 h-4" />
                      <span>~{workflow.metadata?.estimatedTime || '30'} min</span>
                    </div>

                    <Button
                      className="w-full"
                      onClick={() => handleStartWorkflow(workflow.id)}
                    >
                      <Play className="w-4 h-4 mr-2" />
                      Start Workflow
                    </Button>
                  </CardContent>
                </Card>
              ))}
            </div>
          </div>
        );
      })}
    </div>
  );
}
```

### Active Workflows Component

```tsx
// src/components/workflows/active-workflows.tsx
'use client';

import { useEffect, useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { Pause, Play, X } from 'lucide-react';
import { WorkflowExecution } from '@/types';

export function ActiveWorkflows() {
  const [executions, setExecutions] = useState<WorkflowExecution[]>([]);

  useEffect(() => {
    fetchActiveWorkflows();

    // Poll for updates every 5 seconds
    const interval = setInterval(fetchActiveWorkflows, 5000);
    return () => clearInterval(interval);
  }, []);

  const fetchActiveWorkflows = async () => {
    const res = await fetch('/api/workflows/executions?status=in_progress');
    const data = await res.json();
    setExecutions(data);
  };

  const handlePause = async (id: string) => {
    await fetch(`/api/workflows/executions/${id}`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ status: 'paused' })
    });
    fetchActiveWorkflows();
  };

  const handleResume = async (id: string) => {
    await fetch(`/api/workflows/executions/${id}`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ status: 'in_progress' })
    });
    fetchActiveWorkflows();
  };

  const handleCancel = async (id: string) => {
    await fetch(`/api/workflows/executions/${id}`, {
      method: 'DELETE'
    });
    fetchActiveWorkflows();
  };

  if (executions.length === 0) {
    return (
      <div className="text-center py-12 text-muted-foreground">
        No active workflows. Start one from the Library tab.
      </div>
    );
  }

  return (
    <div className="space-y-4">
      {executions.map((execution) => {
        const completedSteps = execution.steps.filter(s => s.status === 'completed').length;
        const totalSteps = execution.steps.length;
        const progress = (completedSteps / totalSteps) * 100;

        return (
          <Card key={execution.id}>
            <CardHeader>
              <div className="flex items-start justify-between">
                <div>
                  <CardTitle>{execution.workflowName}</CardTitle>
                  <p className="text-sm text-muted-foreground mt-1">
                    {completedSteps} of {totalSteps} steps completed
                  </p>
                </div>

                <div className="flex gap-2">
                  {execution.status === 'paused' ? (
                    <Button
                      variant="outline"
                      size="icon"
                      onClick={() => handleResume(execution.id)}
                    >
                      <Play className="h-4 w-4" />
                    </Button>
                  ) : (
                    <Button
                      variant="outline"
                      size="icon"
                      onClick={() => handlePause(execution.id)}
                    >
                      <Pause className="h-4 w-4" />
                    </Button>
                  )}

                  <Button
                    variant="outline"
                    size="icon"
                    onClick={() => handleCancel(execution.id)}
                  >
                    <X className="h-4 w-4" />
                  </Button>
                </div>
              </div>
            </CardHeader>

            <CardContent>
              <Progress value={progress} className="mb-4" />

              <div className="space-y-2">
                {execution.steps.map((step, index) => (
                  <div key={step.id} className="flex items-center gap-2 text-sm">
                    {step.status === 'completed' && (
                      <CheckCircle className="w-4 h-4 text-green-600" />
                    )}
                    {step.status === 'in_progress' && (
                      <div className="w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin" />
                    )}
                    {step.status === 'pending' && (
                      <div className="w-4 h-4 border-2 border-gray-300 rounded-full" />
                    )}

                    <span className={step.status === 'in_progress' ? 'font-medium' : ''}>
                      {index + 1}. {step.name}
                    </span>
                  </div>
                ))}
              </div>

              <Button
                className="w-full mt-4"
                onClick={() => window.location.href = `/workflows/executions/${execution.id}`}
              >
                Continue
              </Button>
            </CardContent>
          </Card>
        );
      })}
    </div>
  );
}
```

### Workflow History Component

```tsx
// src/components/workflows/workflow-history.tsx
'use client';

import { useEffect, useState } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { CheckCircle, XCircle, Clock } from 'lucide-react';
import { formatRelativeTime } from '@/lib/utils';
import { WorkflowExecution } from '@/types';

export function WorkflowHistory() {
  const [executions, setExecutions] = useState<WorkflowExecution[]>([]);

  useEffect(() => {
    fetchHistory();
  }, []);

  const fetchHistory = async () => {
    const res = await fetch('/api/workflows/executions?limit=20');
    const data = await res.json();
    setExecutions(data);
  };

  return (
    <div className="space-y-3">
      {executions.map((execution) => {
        const duration = execution.completedAt
          ? Math.floor((new Date(execution.completedAt).getTime() - new Date(execution.startedAt).getTime()) / 1000 / 60)
          : null;

        return (
          <Card key={execution.id} className="hover:bg-accent/50 transition-colors cursor-pointer">
            <CardContent className="p-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  {execution.status === 'completed' && (
                    <CheckCircle className="w-5 h-5 text-green-600" />
                  )}
                  {execution.status === 'failed' && (
                    <XCircle className="w-5 h-5 text-red-600" />
                  )}
                  {execution.status === 'in_progress' && (
                    <div className="w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin" />
                  )}

                  <div>
                    <p className="font-medium">{execution.workflowName}</p>
                    <p className="text-sm text-muted-foreground">
                      {formatRelativeTime(execution.startedAt)}
                      {duration && ` â€¢ ${duration} min`}
                    </p>
                  </div>
                </div>

                <Badge variant={
                  execution.status === 'completed' ? 'default' :
                  execution.status === 'failed' ? 'destructive' :
                  'secondary'
                }>
                  {execution.status}
                </Badge>
              </div>
            </CardContent>
          </Card>
        );
      })}
    </div>
  );
}
```

---

## Tasks

| Task | Estimate |
|------|----------|
| Create workflow dashboard page | 30 min |
| Build workflow library component | 60 min |
| Build active workflows component | 60 min |
| Build workflow history component | 45 min |
| Add real-time progress updates | 30 min |
| Create workflow detail page | 45 min |
| Write tests | 30 min |

---

## Acceptance Criteria
- [ ] Workflow library displays all workflows
- [ ] Can start workflows from UI
- [ ] Active workflows show progress
- [ ] Pause/resume works
- [ ] History shows past executions
- [ ] Real-time updates work
- [ ] Mobile-responsive

---

## Dependencies

Already included in WEB-8.1
