# Feature 0.4: Basic CLI Interface

## Metadata
| Field | Value |
|-------|-------|
| **Feature ID** | 0.4 |
| **Phase** | 0 - Foundation |
| **Priority** | Critical |
| **Estimated Effort** | 4-6 hours |
| **Dependencies** | 0.1 (Project Setup), 0.3 (Core Architecture) |
| **Approval** | [ ] |
| **Status** | Not Started |

---

## Overview

Implement the basic CLI interface for Business-OS including input handling, output formatting, command parsing, and the main REPL loop.

## User Story

As a **user**, I want a **clean command-line interface** so that **I can interact with my AI co-founder through the terminal**.

---

## Requirements

### Functional Requirements
1. Interactive REPL loop
2. Colorized output (chalk)
3. Command parsing (/ commands)
4. Input history (up/down arrows)
5. Graceful shutdown (Ctrl+C)
6. Loading indicators for API calls
7. Multi-line input support

### Non-Functional Requirements
- Responsive (< 50ms input latency)
- Works on macOS, Linux, Windows
- No flickering or visual glitches
- Clear error messages

---

## Technical Specification

### CLI Commands

| Command | Description |
|---------|-------------|
| `/help` | Show available commands |
| `/clear` | Clear conversation history |
| `/context` | Show current business context |
| `/save` | Save conversation |
| `/load <id>` | Load conversation |
| `/quit` or `/exit` | Exit the application |
| `/debug` | Toggle debug mode |

### Main REPL Loop

```typescript
// src/cli/repl.ts
import * as readline from 'readline';
import chalk from 'chalk';

export class REPL {
  private rl: readline.Interface;
  private isRunning: boolean = false;

  constructor(
    private chatService: IChatService,
    private logger: ILogger
  ) {
    this.rl = readline.createInterface({
      input: process.stdin,
      output: process.stdout,
      terminal: true,
      historySize: 100
    });
  }

  async start(): Promise<void> {
    this.isRunning = true;
    this.printWelcome();

    while (this.isRunning) {
      const input = await this.prompt();

      if (input.startsWith('/')) {
        await this.handleCommand(input);
      } else if (input.trim()) {
        await this.handleMessage(input);
      }
    }
  }

  private async prompt(): Promise<string> {
    return new Promise((resolve) => {
      this.rl.question(chalk.cyan('You: '), resolve);
    });
  }

  private printWelcome(): void {
    console.log(chalk.bold('\nðŸš€ Business-OS v0.1'));
    console.log(chalk.gray('Your AI co-founder. Type /help for commands.\n'));
  }
}
```

### Output Formatting

```typescript
// src/cli/formatter.ts
import chalk from 'chalk';

export const format = {
  user: (text: string) => chalk.cyan(`You: ${text}`),
  assistant: (text: string) => chalk.green(`Mentor: ${text}`),
  system: (text: string) => chalk.gray(`[System] ${text}`),
  error: (text: string) => chalk.red(`Error: ${text}`),
  success: (text: string) => chalk.green(`âœ“ ${text}`),
  warning: (text: string) => chalk.yellow(`âš  ${text}`),
  info: (text: string) => chalk.blue(`â„¹ ${text}`),
};
```

### Spinner for Loading States

```typescript
// src/cli/spinner.ts
import ora from 'ora';

export function withSpinner<T>(
  promise: Promise<T>,
  message: string
): Promise<T> {
  const spinner = ora(message).start();

  return promise
    .then((result) => {
      spinner.succeed();
      return result;
    })
    .catch((error) => {
      spinner.fail();
      throw error;
    });
}
```

### Entry Point

```typescript
// src/index.ts
import { REPL } from './cli/repl';
import { container } from './infrastructure/container';
import { loadConfig } from './config';

async function main() {
  try {
    const config = loadConfig();
    const chatService = container.resolve<IChatService>('chatService');

    const repl = new REPL(chatService, console);

    // Handle shutdown
    process.on('SIGINT', () => {
      console.log('\nðŸ‘‹ Goodbye!');
      process.exit(0);
    });

    await repl.start();
  } catch (error) {
    console.error('Failed to start:', error);
    process.exit(1);
  }
}

main();
```

---

## Tasks Breakdown

| Task | Description | Estimate |
|------|-------------|----------|
| 0.4.1 | Create REPL class with basic loop | 45 min |
| 0.4.2 | Implement command parser | 30 min |
| 0.4.3 | Add colorized output formatting | 30 min |
| 0.4.4 | Implement /help command | 15 min |
| 0.4.5 | Implement /clear command | 15 min |
| 0.4.6 | Implement /quit command | 15 min |
| 0.4.7 | Add loading spinner | 30 min |
| 0.4.8 | Handle Ctrl+C gracefully | 15 min |
| 0.4.9 | Add input history | 30 min |
| 0.4.10 | Write integration tests | 45 min |

---

## Acceptance Criteria

- [ ] CLI starts with welcome message
- [ ] User can type messages
- [ ] /help shows all commands
- [ ] /clear clears screen and history
- [ ] /quit exits cleanly
- [ ] Ctrl+C exits without error
- [ ] Loading spinner during API calls
- [ ] Up/down arrows cycle history
- [ ] Errors displayed in red
- [ ] Works on macOS and Linux

---

## Dependencies (npm)

```json
{
  "dependencies": {
    "chalk": "^5.3.0",
    "ora": "^8.0.0"
  }
}
```

---

## File Structure

```
src/
â”œâ”€â”€ cli/
â”‚   â”œâ”€â”€ index.ts        # CLI exports
â”‚   â”œâ”€â”€ repl.ts         # Main REPL loop
â”‚   â”œâ”€â”€ commands.ts     # Command handlers
â”‚   â”œâ”€â”€ formatter.ts    # Output formatting
â”‚   â””â”€â”€ spinner.ts      # Loading indicators
â””â”€â”€ index.ts            # Entry point
```

---

## Risks & Mitigations

| Risk | Impact | Mitigation |
|------|--------|------------|
| Windows compatibility | Medium | Test on Windows, use cross-platform libs |
| Terminal escape codes | Low | Use chalk which handles this |

---

## Definition of Done

- [ ] All tasks completed
- [ ] All acceptance criteria met
- [ ] Manual testing on macOS
- [ ] No console errors
- [ ] Clean exit on all signals

