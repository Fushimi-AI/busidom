# Feature 2.5: Data Export/Import (CLI)

## Metadata
| Field | Value |
|-------|-------|
| **Feature ID** | CLI-2.5 |
| **Phase** | 2 - Local Storage (CLI) |
| **Priority** | Medium |
| **Estimated Effort** | 2-3 hours |
| **Dependencies** | CLI-2.3 (Conversation Storage), CLI-2.4 (Business Entity) |
| **Approval** | [ ] |
| **Status** | Not Started |

---

## Overview

Export all user data from SQLite to JSON/Markdown for backup, portability, and migration to cloud version.

## Technical Specification

```typescript
// src/core/export/cli-export.service.ts
export class CLIExportService {
  constructor(
    private db: SQLiteClient,
    private businessRepo: BusinessRepository,
    private conversationRepo: ConversationRepository,
    private messageRepo: MessageRepository
  ) {}

  async exportAll(userId: string): Promise<ExportData> {
    const businesses = await this.businessRepo.findByUserId(userId);

    const exportBusinesses = await Promise.all(
      businesses.map(async (business) => {
        const conversations = await this.conversationRepo.findByBusinessId(business.id);

        const exportConversations = await Promise.all(
          conversations.map(async (conv) => {
            const messages = await this.messageRepo.findByConversationId(conv.id);
            return {
              id: conv.id,
              title: conv.title,
              messages: messages.map(m => ({
                role: m.role,
                content: m.content,
                timestamp: new Date(m.created_at * 1000).toISOString()
              })),
              createdAt: new Date(conv.created_at * 1000).toISOString(),
              updatedAt: new Date(conv.updated_at * 1000).toISOString()
            };
          })
        );

        return {
          id: business.id,
          name: business.name,
          industry: business.industry,
          stage: business.stage,
          context: business.context,
          conversations: exportConversations,
          createdAt: new Date(business.created_at * 1000).toISOString(),
          updatedAt: new Date(business.updated_at * 1000).toISOString()
        };
      })
    );

    return {
      version: '1.0',
      exportedAt: new Date().toISOString(),
      user: { id: userId, email: '' },
      businesses: exportBusinesses
    };
  }

  async exportToFile(userId: string, filePath: string): Promise<void> {
    const data = await this.exportAll(userId);
    await fs.writeFile(filePath, JSON.stringify(data, null, 2));
  }
}
```

---

## Tasks

| Task | Estimate |
|------|----------|
| Create CLIExportService | 30 min |
| Implement JSON export | 30 min |
| Implement Markdown export | 30 min |
| Add /export command | 15 min |
| Add /import command | 30 min |
| Write tests | 20 min |

---

## Acceptance Criteria
- [ ] Export to JSON works
- [ ] Export to Markdown works
- [ ] Import from JSON works
- [ ] Compatible with web export format
- [ ] /export and /import commands work
