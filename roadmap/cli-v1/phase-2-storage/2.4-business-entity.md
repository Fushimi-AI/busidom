# Feature 2.4: Business Entity Model (CLI)

## Metadata
| Field | Value |
|-------|-------|
| **Feature ID** | CLI-2.4 |
| **Phase** | 2 - Local Storage (CLI) |
| **Priority** | High |
| **Estimated Effort** | 3-4 hours |
| **Dependencies** | CLI-2.1 (SQLite), CLI-2.2 (Local User) |
| **Approval** | [ ] |
| **Status** | Not Started |

---

## Overview

Same business entity model as web version, but stored locally in SQLite. Supports multiple businesses per user.

## Technical Specification

```typescript
// src/infrastructure/repositories/business.repository.ts
export class BusinessRepository {
  constructor(private db: SQLiteClient) {}

  async create(data: {
    userId: string;
    name: string;
    industry?: string;
    stage?: BusinessStage;
  }): Promise<Business> {
    return this.db.queryOne<Business>(
      `INSERT INTO businesses (id, user_id, name, industry, stage, context)
       VALUES (?, ?, ?, ?, ?, ?)
       RETURNING *`,
      [
        generateId(),
        data.userId,
        data.name,
        data.industry || null,
        data.stage || 'idea',
        JSON.stringify({
          targetCustomer: null,
          problemStatement: null,
          challenges: [],
          goals: [],
        })
      ]
    )!;
  }

  async findByUserId(userId: string): Promise<Business[]> {
    const rows = this.db.query<any>(
      `SELECT * FROM businesses WHERE user_id = ? ORDER BY updated_at DESC`,
      [userId]
    );

    return rows.map(r => ({
      ...r,
      context: JSON.parse(r.context)
    }));
  }

  async updateContext(id: string, context: Partial<BusinessContext>): Promise<void> {
    const current = await this.findById(id);
    const merged = { ...current!.context, ...context };

    this.db.execute(
      `UPDATE businesses SET context = ?, updated_at = unixepoch() WHERE id = ?`,
      [JSON.stringify(merged), id]
    );
  }

  async findById(id: string): Promise<Business | null> {
    const row = this.db.queryOne<any>(`SELECT * FROM businesses WHERE id = ?`, [id]);
    if (!row) return null;

    return {
      ...row,
      context: JSON.parse(row.context)
    };
  }
}
```

---

## Tasks

| Task | Estimate |
|------|----------|
| Create BusinessRepository | 45 min |
| Implement CRUD operations | 30 min |
| Add context management | 30 min |
| Implement /business commands | 30 min |
| Write tests | 30 min |

---

## Acceptance Criteria
- [ ] Create/update/delete businesses
- [ ] Multiple businesses supported
- [ ] Context stored as JSON
- [ ] /business commands work
- [ ] Can switch active business
