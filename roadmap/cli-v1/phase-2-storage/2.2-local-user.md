# Feature 2.2: Local User Storage (CLI)

## Metadata
| Field | Value |
|-------|-------|
| **Feature ID** | CLI-2.2 |
| **Phase** | 2 - Local Storage (CLI) |
| **Priority** | High |
| **Estimated Effort** | 2-3 hours |
| **Dependencies** | CLI-2.1 (SQLite Setup) |
| **Approval** | [ ] |
| **Status** | Not Started |

---

## Overview

Simple local user profile for CLI - no authentication needed since it's single-user local tool. Just tracks user identity for data organization.

## User Story

As a **CLI user**, I want a **simple profile** so that **my data is organized under my identity**.

---

## Requirements

### Functional
1. Create user profile on first run
2. Store user preferences
3. User switching (multiple profiles)
4. No passwords (local only)

### Non-Functional
- Zero-friction setup
- Portable profiles
- No authentication overhead

---

## Technical Specification

```typescript
// src/core/user/local-user.service.ts
export interface LocalUser {
  id: string;
  email: string;
  name: string;
  preferences: UserPreferences;
  createdAt: Date;
}

export interface UserPreferences {
  defaultModel: string;
  theme: 'light' | 'dark';
  notificationsEnabled: boolean;
}

export class LocalUserService {
  constructor(private db: SQLiteClient) {}

  async getCurrentUser(): Promise<LocalUser | null> {
    return this.db.queryOne<LocalUser>(
      'SELECT * FROM users WHERE id = (SELECT value FROM settings WHERE key = "current_user_id")'
    );
  }

  async createUser(data: { email: string; name: string }): Promise<LocalUser> {
    const user = await this.db.queryOne<LocalUser>(
      `INSERT INTO users (id, email, name, preferences)
       VALUES (?, ?, ?, ?)
       RETURNING *`,
      [generateId(), data.email, data.name, JSON.stringify({
        defaultModel: 'gpt-4',
        theme: 'dark',
        notificationsEnabled: true
      })]
    );

    // Set as current user
    await this.db.execute(
      `INSERT INTO settings (key, value) VALUES ('current_user_id', ?)
       ON CONFLICT(key) DO UPDATE SET value = excluded.value`,
      [user!.id]
    );

    return user!;
  }

  async switchUser(userId: string): Promise<void> {
    await this.db.execute(
      `UPDATE settings SET value = ? WHERE key = 'current_user_id'`,
      [userId]
    );
  }
}
```

### First-Run Setup

```typescript
// src/cli/first-run.ts
export async function firstRunSetup(): Promise<LocalUser> {
  console.log(chalk.bold('\nðŸ‘‹ Welcome to Business-OS!\n'));

  const email = await promptInput('Email (for data export): ');
  const name = await promptInput('Name: ');

  const userService = new LocalUserService(db);
  const user = await userService.createUser({ email, name });

  console.log(chalk.green(`\nâœ“ Profile created for ${name}`));
  return user;
}
```

---

## Tasks

| Task | Estimate |
|------|----------|
| Create LocalUserService | 30 min |
| Add first-run setup | 30 min |
| Implement user switching | 20 min |
| Add /profile command | 15 min |
| Write tests | 30 min |

---

## Acceptance Criteria
- [ ] First run prompts for user info
- [ ] User profile persists
- [ ] Can switch between profiles
- [ ] /profile shows current user
- [ ] No password required

---

## CLI Commands

```bash
bos profile           # Show current profile
bos profile switch    # Switch user profile
bos profile create    # Create new profile
```
